Náº¿u Ä‘á»ƒ **FE (Frontend)** lÃ m pháº§n láº¥y token Web Push tháº­t (Ä‘á»™ng), thÃ¬ flow chuáº©n sáº½ nhÆ° sau:

### ğŸ”¹ CÃ¡c bÆ°á»›c FE cáº§n lÃ m

1. **ÄÄƒng kÃ½ Service Worker**

   * FE viáº¿t 1 file `service-worker.js` Ä‘á»ƒ láº¯ng nghe push event.
   * Trong `index.html` hoáº·c React/Vue/Angular, FE Ä‘Äƒng kÃ½:

     ```javascript
     if ("serviceWorker" in navigator) {
       navigator.serviceWorker.register("/service-worker.js").then(() => {
         console.log("Service Worker registered");
       });
     }
     ```

2. **Xin quyá»n hiá»ƒn thá»‹ thÃ´ng bÃ¡o**

   ```javascript
   Notification.requestPermission().then(permission => {
     if (permission === "granted") {
       console.log("Notification permission granted.");
     }
   });
   ```

3. **Láº¥y Subscription (Push Token)**

   * FE dÃ¹ng **Push API** + **VAPID public key** (key nÃ y BE cung cáº¥p) Ä‘á»ƒ táº¡o subscription:

     ```javascript
     navigator.serviceWorker.ready.then(registration => {
       const vapidPublicKey = "BE_PUBLIC_KEY"; // BE generate vÃ  Ä‘Æ°a cho FE
       const convertedKey = urlBase64ToUint8Array(vapidPublicKey);

       registration.pushManager.subscribe({
         userVisibleOnly: true,
         applicationServerKey: convertedKey
       }).then(subscription => {
         console.log("Push subscription:", JSON.stringify(subscription));
         // Gá»­i subscription vá» BE Ä‘á»ƒ lÆ°u
       });
     });
     ```

   > **Subscription nÃ y chÃ­nh lÃ  â€œtoken tháº­tâ€** (chá»©a endpoint + keys).

4. **Gá»­i token vá» BE**

   * FE call API `POST /api/push/subscription`
   * Payload vÃ­ dá»¥:

     ```json
     {
       "userId": "1",
       "subscription": {
         "endpoint": "https://fcm.googleapis.com/fcm/send/xxxxx",
         "keys": {
           "p256dh": "BOKL....",
           "auth": "abc123..."
         }
       }
     }
     ```
   * BE lÆ°u vÃ o DB.

5. **Nháº­n thÃ´ng bÃ¡o**

   * Khi BE gá»­i push vá» endpoint, Service Worker láº¯ng nghe vÃ  hiá»ƒn thá»‹:

     ```javascript
     self.addEventListener("push", function(event) {
       const data = event.data.json();
       event.waitUntil(
         self.registration.showNotification(data.Title, {
           body: data.Body,
           data: data.Data
         })
       );
     });
     ```

---

ğŸ‘‰ NhÆ° váº­y:

* **Hiá»‡n táº¡i** báº¡n test thÃ¬ sá»­a JSON input tÄ©nh nhÆ° báº¡n paste á»Ÿ trÃªn lÃ  OK.
* **Sau nÃ y** khi FE lÃ m xong pháº§n trÃªn, `ReceiverIds` hoáº·c `subscription` sáº½ Ä‘Æ°á»£c gá»­i tá»« FE vá» BE (thay tÄ©nh thÃ nh Ä‘á»™ng).

Báº¡n cÃ³ muá»‘n mÃ¬nh viáº¿t luÃ´n Ä‘oáº¡n **API `POST /api/push/subscription` bÃªn BE** Ä‘á»ƒ FE gá»i thá»­ lÆ°u token tháº­t ko?
